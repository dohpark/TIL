## Big Picture (Architecture)

### Use Cases

- 그큐엘 서버를 포함하는 3가지의 아키텍처를 봅세
  1. 그큐엘 서버와 연결된 데이터베이스
  2. 다수의 타사 또는 레거시 시스템 앞에 있는 얇은 계층의 GraphQL 서버로 단일 GraphQL API를 통해 통합하는 경우
  3. 동일한 GraphQL API를 통해 모두 액세스할 수 있는 연결된 데이터베이스와 타사 또는 레거시 시스템의 하이브리드 접근 방식
- 세 아키텍처 모두 그큐엘의 대표적인 사례이며 강한 유연성을 보임

#### 1. GraphQL server with a connected database

- 이 아키텍처는 greenfield(미개발) 프로젝트에 가장 많이 사용됨. 그큐엘 사양을 구현한 하나의 웹 서버가 있으다고 함. 쿼리가 그큐엘 서버에 도착을 하면, 서버는 쿼리의 페이로드를 읽고 요구하는 정보를 데이터베이스에서 가져옴. 이는 쿼리를 resolving (해결) 한다고 부름. 그 다음 공식 사양에 설명된 대로 응답 오브젝트를 구성하고 클라이언트에 리턴함.
- GraphQL은 실제로 전송 계층에 구애받지 않는다는 점을 유의해야함. 이는 잠재적으로 사용 가능한 모든 네트워크 프로토콜과 함께 사용할 수 있음을 의미함. 따라서 TCP, WebSocket 등을 기반으로 GraphQL 서버를 구현하는 것이 잠재적으로 가능함.
- 그큐엘은 데이터베이스 혹은 포맷 상관없이 사용 가능함. AWS Aurora와 같은 SQL 데이터베이스를 사용해도 되고 몽고디비같은 NoSQL 데이터베이스에 사용해도 됨.

#### 2. GraphQL layer that integrates existing systems

- 그큐엘의 강점 중 하나는 하나의 일관된 GraphQL API 뒤에 여러 기존 시스템을 통합할 수 있다는 점임. 이는 수년에 걸쳐 성장하여 현재 높은 유지 관리 부담을 부과하는 레거시 인프라와 다양한 API를 보유한 회사에 특히 매력적임. 이러한 레거시 시스템의 주요 문제 중 하나는 여러 시스템에 액세스해야 하는 혁신적인 제품을 구축하는 것이 사실상 불가능하다는 것임.

- 이러한 맥락에서 GraphQL을 사용하여 이러한 기존 시스템을 통합하고 GraphQL API 뒤에 복잡성을 숨길 수 있음. 이런 식으로 GraphQL 서버와 간단히 대화하여 필요한 데이터를 가져오는 새로운 클라이언트 응용 프로그램을 개발할 수 있음. 그러면 GraphQL 서버는 기존 시스템에서 데이터를 가져와 GraphQL 응답 형식으로 패키징함.

- GraphQL 서버가 사용 중인 데이터베이스 유형에 신경 쓰지 않았듯이 쿼리를 resolve하기 위해 어디에서 데이터 소스를 가져오는지에 대해서 신경 쓰지 않아도 됨

#### 3. Hybrid approach with connected database and integration of existing system

- 마지막으로, 두 가지 접근 방식을 결합하고 연결된 데이터베이스가 있지만 여전히 레거시 또는 타사 시스템과 통신하는 GraphQL 서버를 구축할 수 있음
- 쿼리가 서버에 수신되면 서버는 이를 resolve하고 연결된 데이터베이스 또는 일부 통합 API에서 필요한 데이터를 검색함.

### Resolver Functions

- 그러나 GraphQL을 사용하여 이러한 유연성을 얻으려면 어떻게 해야 함? 어떻게 이렇게 다양한 사용 사례에 적합함?
- 그큐엘 쿼리 (혹은 mutation)의 payload는 field 세트들로 구성되어 있음. 그뮤엘 서버 구현에서 이러한 각 필드는 resolver라고 하는 하나의 함수에 해당함. 리졸버 함수의 유일한 목적은 해당 필드에 대한 데이터를 가져오는 것임.
- 서버가 쿼리를 수신하면 해당 쿼리의 페이로드에 지정된 필드의 모든 함수를 호출함. 쿼리를 resole (해결)하고 각 필드에 대한 정확한 데이터를 검색할 수 있음. 모든 resolver들이 리턴되면 서버는 쿼리에 작성된 형식으로 데이터를 패키징하고 클라이언트로 다시 보냄.

### GraphQL Client Libraries

- 그큐엘은 프론트엔드 개발자들에게 편리함 왜냐하면 REST API의 단점들을 해결해주고, 복잡한 일들은 서버 사이드로 넘겨지기 때문임. 클라이언트는 데이터가 어디에서 오는지 신경 쓰지 않아도 되며, 하나의 견고하며 유연한 API를 사용하면 됨.

- REST API 사용시 아래의 절차를 따름

  1. HTTP 요청을 만들고 전송해야함
  2. 서버 응답을 받고 파싱해야함
  3. 데이터를 로컬에 저장함
  4. 데이터를 UI에 나타냄

- 선언적 데이터 fetching 접근을 따르면 클라이언트는 두가지의 절차만 따르면 됨

  1. 데이터 요구사항을 작성함
  2. 데이터를 UI에 나타냄

- 모든 하위 수준 네트워킹 작업과 데이터 저장은 추상화되어야 하며 데이터 종속성 선언이 지배적인 부분이어야 함.
- 이것이 바로 Relay 또는 Apollo와 같은 GraphQL 클라이언트 라이브러리를 사용하여 수행할 수 있는 작업임. 인프라의 반복적인 구현을 처리하는 대신 애플리케이션의 중요한 부분에 집중할 수 있어야 한다는 추상화를 제공함.
